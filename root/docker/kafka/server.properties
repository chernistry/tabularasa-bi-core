# Kafka Production Configuration for TabulaRasa BI Core
# Optimized for high-throughput streaming data processing

############################# Server Basics #############################
broker.id=1
num.network.threads=8
num.io.threads=16
socket.send.buffer.bytes=102400
socket.receive.buffer.bytes=102400
socket.request.max.bytes=104857600

############################# Log Basics #############################
log.dirs=/bitnami/kafka/logs
num.partitions=3
num.recovery.threads.per.data.dir=2

############################# Internal Topic Settings  #############################
offsets.topic.replication.factor=1
transaction.state.log.replication.factor=1
transaction.state.log.min.isr=1

############################# Log Flush Policy #############################
# Flush settings for durability vs performance trade-off
log.flush.interval.messages=10000
log.flush.interval.ms=1000

############################# Log Retention Policy #############################
# Data retention for streaming analytics (7 days default)
log.retention.hours=168
log.retention.bytes=1073741824
log.segment.bytes=134217728
log.retention.check.interval.ms=300000
log.cleanup.policy=delete

############################# Compression #############################
# Enable compression for better throughput
compression.type=snappy
log.compression.type=snappy

############################# Performance Tuning #############################
# Message size limits
message.max.bytes=1048576
replica.fetch.max.bytes=1048576

# Batch settings for better throughput
batch.size=65536
linger.ms=5

# Buffer settings
send.buffer.bytes=131072
receive.buffer.bytes=131072

# Background thread settings
num.replica.fetchers=4
num.replica.alter.log.dirs.threads=2

############################# Producer/Consumer Defaults #############################
# Producer configurations
producer.buffer.memory=33554432
producer.batch.size=65536
producer.linger.ms=5
producer.acks=1
producer.retries=2147483647
producer.enable.idempotence=true

# Consumer configurations
consumer.fetch.min.bytes=1024
consumer.fetch.max.wait.ms=500
consumer.max.partition.fetch.bytes=1048576
consumer.session.timeout.ms=30000
consumer.heartbeat.interval.ms=10000

############################# Replication #############################
default.replication.factor=1
min.insync.replicas=1
unclean.leader.election.enable=false
leader.imbalance.per.broker.percentage=10
leader.imbalance.check.interval.seconds=300

############################# Zookeeper (Not used in KRaft mode) #############################
# These settings are kept for compatibility but not used in KRaft mode
# zookeeper.connect=localhost:2181
# zookeeper.connection.timeout.ms=18000

############################# KRaft Mode Settings #############################
# KRaft is enabled via environment variables in docker-compose
# process.roles=broker,controller
# node.id=1
# controller.quorum.voters=1@kafka:9093
# listeners=PLAINTEXT://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093
# inter.broker.listener.name=PLAINTEXT
# advertised.listeners=PLAINTEXT://localhost:9092
# controller.listener.names=CONTROLLER
# listener.security.protocol.map=PLAINTEXT:PLAINTEXT,CONTROLLER:PLAINTEXT

############################# Metrics and Monitoring #############################
# JMX settings for monitoring
jmx.port=9999
# Enable metrics for monitoring
metric.reporters=
metrics.num.samples=2
metrics.sample.window.ms=30000

############################# Security #############################
# Security settings (adjust for production)
security.inter.broker.protocol=PLAINTEXT
# sasl.enabled.mechanisms=PLAIN
# sasl.mechanism.inter.broker.protocol=PLAIN

############################# Topic Creation #############################
# Auto topic creation (disable in production)
auto.create.topics.enable=false
delete.topic.enable=true

############################# Advanced Performance Settings #############################
# Replica lag settings
replica.lag.time.max.ms=30000
replica.socket.timeout.ms=30000
replica.socket.receive.buffer.bytes=65536

# Controller settings
controller.socket.timeout.ms=30000

# Group coordinator settings
group.initial.rebalance.delay.ms=3000
group.max.session.timeout.ms=300000
group.min.session.timeout.ms=6000

# Offset settings
offset.metadata.max.bytes=4096
offsets.load.buffer.size=5242880
offsets.retention.check.interval.ms=600000
offsets.retention.minutes=10080
offsets.topic.compression.codec=0
offsets.topic.num.partitions=50
offsets.topic.segment.bytes=104857600

############################# Log Cleaner Settings #############################
log.cleaner.enable=true
log.cleaner.threads=2
log.cleaner.io.max.bytes.per.second=1.7976931348623157E308
log.cleaner.dedupe.buffer.size=134217728
log.cleaner.io.buffer.size=524288
log.cleaner.io.buffer.load.factor=0.9
log.cleaner.backoff.ms=15000
log.cleaner.min.cleanable.ratio=0.5
log.cleaner.delete.retention.ms=86400000

############################# Transaction Settings #############################
# Transaction coordinator settings
transaction.state.log.load.buffer.size=5242880
transaction.state.log.num.partitions=50
transaction.state.log.segment.bytes=104857600
transaction.max.timeout.ms=900000
transaction.abort.timed.out.transaction.cleanup.interval.ms=60000
transaction.remove.expired.transaction.cleanup.interval.ms=3600000

############################# Request Processing #############################
# Request processing settings
request.timeout.ms=30000
connections.max.idle.ms=600000
max.connections.per.ip=2147483647
max.connections=2147483647

############################# Quota Settings #############################
# Quota settings for rate limiting
quota.consumer.default=9223372036854775807
quota.producer.default=9223372036854775807
quota.window.num=11
quota.window.size.seconds=1

############################# Additional Settings #############################
# Additional performance and reliability settings
queued.max.requests=500
fetch.purgatory.purge.interval.requests=1000
producer.purgatory.purge.interval.requests=1000
replica.high.watermark.checkpoint.interval.ms=5000